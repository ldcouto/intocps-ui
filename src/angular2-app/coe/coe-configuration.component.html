<form *ngIf="config" (ngSubmit)="onSubmit()" #configForm="ngForm">

    <div class="form-horizontal">
        <div class="form-group">
            <label class="col-sm-2 control-label">Start time</label>
            <div class="col-sm-10">
                <p *ngIf="!editing" class="form-control-static">{{config.startTime}}</p>
                <input *ngIf="editing" name="startTime" [(ngModel)]="config.startTime" class="form-control" required>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">End time</label>
            <div class="col-sm-10">
                <p *ngIf="!editing" class="form-control-static">{{config.endTime}}</p>
                <input *ngIf="editing" name="endTime" [(ngModel)]="config.endTime" class="form-control" required>
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">Algorithm</label>
            <div class="col-sm-10">
                <p *ngIf="!editing" class="form-control-static">{{getAlgorithmName(config.algorithm)}}</p>
                <select *ngIf="editing" name="algorithm" [(ngModel)]="config.algorithm" class="form-control" required>
                    <option *ngFor="let algorithm of algorithms" [ngValue]="algorithm">{{getAlgorithmName(algorithm)}}</option>
                </select>
            </div>
        </div>
    </div>

    <hr>

    <div *ngIf="getAlgorithmName(config.algorithm) == 'Fixed Step'">
        <div class="form-horizontal">
            <div class="form-group">
                <label class="col-sm-2 control-label">Step size</label>
                <div class="col-sm-10">
                    <p *ngIf="!editing" class="form-control-static">{{config.algorithm.size}}</p>
                    <input *ngIf="editing" name="stepSize" [(ngModel)]="config.algorithm.size" class="form-control" required>
                </div>
            </div>
        </div>
    </div>

    <div *ngIf="getAlgorithmName(config.algorithm) == 'Variable Step'">
        <div class="form-horizontal">
            <div class="form-group">
                <label class="col-sm-2 control-label">Initial step size</label>
                <div class="col-sm-10">
                    <p *ngIf="!editing" class="form-control-static">{{config.algorithm.initSize}}</p>
                    <input *ngIf="editing" name="initStepSize" [(ngModel)]="config.algorithm.initSize" class="form-control" required>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">Minimum step size</label>
                <div class="col-sm-10">
                    <p *ngIf="!editing" class="form-control-static">{{config.algorithm.sizeMin}}</p>
                    <input *ngIf="editing" name="minStepSize" [(ngModel)]="config.algorithm.sizeMin" class="form-control" required>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">Maximum step size</label>
                <div class="col-sm-10">
                    <p *ngIf="!editing" class="form-control-static">{{config.algorithm.sizeMax}}</p>
                    <input *ngIf="editing" name="maxStepSize" [(ngModel)]="config.algorithm.sizeMax" class="form-control" required>
                </div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">Constraints</label>
                <div class="col-sm-10">
                    <div *ngIf="editing" class="input-group">
                        <select [(ngModel)]="newConstraint" name="newConstraint" class="form-control">
                            <option *ngFor="let constraint of constraintConstructors" [ngValue]="constraint">{{getConstraintName(constraint)}}</option>
                        </select>
                        <span class="input-group-btn">
                            <button type="button" (click)="addConstraint()" class="btn btn-default">
                                <span class="glyphicon glyphicon-plus"></span> Add
                            </button>
                        </span>
                    </div>
                </div>
            </div>
        </div>

        <div class="constraint-container">
            <div class="panel panel-default constraint-panel" *ngFor="let constraint of config.algorithm.constraints">
                <div class="panel-heading">
                    <a *ngIf="editing" (click)="removeConstraint(constraint)" class="pull-right"><span class="glyphicon glyphicon-remove"></span></a>
                    {{getConstraintName(constraint)}}
                </div>
                <div class="panel-body">
                    <zero-crossing [editing]="editing" [ports]="outputPorts" [constraint]="constraint" *ngIf="constraint.type === 'zerocrossing'"></zero-crossing>
                    <bounded-difference [editing]="editing" [ports]="outputPorts" [constraint]="constraint" *ngIf="constraint.type === 'boundeddifference'"></bounded-difference>
                    <sampling-rate [editing]="editing" [constraint]="constraint" *ngIf="constraint.type === 'samplingrate'"></sampling-rate>
                </div>
            </div>

            <div class="clearfix"></div>
        </div>
    </div>

    <hr>

    <label>Livestream Configuration</label>
    <div class="form-horizontal">
        <div class="form-group" *ngFor="let instance of config.multiModel.fmuInstances">
            <label class="col-sm-2 control-label">{{instance.fmu.name}}.{{instance.name}}</label>
            <div class="col-sm-10">
                <div class="checkbox" *ngFor="let output of getOutputs(instance.fmu.scalarVariables)">
                    <label>
                        <input [disabled]="!editing" type="checkbox"
                               [checked]="isLivestreamChecked(instance, output)"
                               (change)="onLivestreamChange($event.target.checked, instance, output)">

                        {{output.name}}
                    </label>
                </div>
            </div>
        </div>
    </div>

    <hr>

    <button *ngIf="!editing" class="btn btn-default" (click)="editing = true">
        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Edit
    </button>
    <button *ngIf="editing" class="btn btn-default" [disabled]="!configForm.form.valid">
        <span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span> Save
    </button>
</form>
