<div *ngIf="parseError">
	<div class="alert alert-danger alert-big">
		<p>Error: Could not parse config.</p>
		<p>Message: {{parseError}}</p>
		<p>Path: {{path}}</p>
	</div>
</div>

<form class="form-horizontal" (ngSubmit)="onMMSubmit()">
	<h4>Experiment Multi-model</h4>

	<div class="form-group">
   		<label class="col-md-3 control-label">Co-simulation experiment</label>
    	<div class="col-md-9">
			<p *ngIf="!editingMM" class="form-control-static">{{getMultiModelName()}}</p>
			<select *ngIf="editingMM"  [ngModel]="cosimConfig" (ngModelChange)="onConfigChange($event)"  [ngModelOptions]="{standalone:true}" class="form-control">
				<option *ngFor="let con of cosimConfig" [ngValue]="con">{{experimentName(con)}}</option>
			</select>

			<button *ngIf="!editingMM" class="btn btn-default" (click)="editingMM = true">
				<span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Set multi-model
			</button>
			<button *ngIf="editingMM" class="btn btn-default">
				<span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span> Save multi-model choice
			</button>
		</div>
	</div>
</form>
		<hr>
		<hr>
		<hr>
		<hr>

<form *ngIf="mmSelected" class="form-horizontal" (ngSubmit)="onSubmit()">
	<button *ngIf="!editing" class="btn btn-default" (click)="editing = true">
        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Edit
    </button>
	<button *ngIf="editing" class="btn btn-default">
        <span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span> Save
    </button>
		
		<h4>DSE Search Algorithms</h4>
		<div class="form-group">
			<label class="col-md-3 control-label">Search Algorithm</label>
			<div class="col-md-9">
				<p *ngIf="!editing" class="form-control-static">{{config.searchAlgorithm.getName()}}</p>
				<select *ngIf="editing" [ngModel]="config.searchAlgorithm.getName()" (ngModelChange)="onAlgorithmChange($event)" [ngModelOptions]="{standalone:true}"
						class="form-control">
					<option *ngFor="let algorithm of algorithms" [ngValue]="algorithm">{{algorithm.getName()}}</option>
				</select>
			</div>
		</div>

		<div *ngIf="config.searchAlgorithm.getName() == 'Genetic'">
			<div class="form-horizontal">
				<div class="form-group">
					<label class="col-sm-5 col-md-4 control-label">Initial population</label>
					<div class="col-sm-7 col-md-8">
						<p *ngIf="!editing" class="form-control-static">{{config.searchAlgorithm.initialPopulation}}</p>
						<input *ngIf="editing" name="initialPopulation" [(ngModel)]="config.searchAlgorithm.initialPopulation" class="form-control">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-5 col-md-4 control-label">Random balanced</label>
					<div class="col-sm-7 col-md-8">
						<p *ngIf="!editing" class="form-control-static">{{config.searchAlgorithm.randomBalanced}}</p>
						<input *ngIf="editing" name="randomBalanced" [(ngModel)]="config.searchAlgorithm.randomBalanced" class="form-control">
					</div>
				</div>

				<div class="form-group">
					<label class="col-sm-5 col-md-4 control-label">Termination rounds</label>
					<div class="col-sm-7 col-md-8">
						<p *ngIf="!editing" class="form-control-static">{{config.searchAlgorithm.terminationRounds}}</p>
						<input *ngIf="editing" name="terminationRounds" [(ngModel)]="config.searchAlgorithm.terminationRounds" class="form-control">
					</div>
				</div>
			</div>
		</div>

		<hr>
		<hr>

		<!--h4>Search Parameters<button *ngIf="editing" type="button" (click)="addParameter()" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-plus"></span>Add Parameter</button></h4>

		<div class="row">
			<div class="col-md-4"><label>Multi-model Parameter</label></div>
			<div class="col-md-4"><label>Initial Values</label></div>
		</div>

		<div class="row" *ngFor="let p of config.dseParameters">
			<div class="col-md-4">
				<p *ngIf="!editing" class="form-control-static">{{getParameterName(p)}}</p>
				<input *ngIf="editing" [ngModel]="getParameterName(p)" (ngModelChange)="setParameterName(p, $event)" [ngModelOptions]="{standalone:true}"
					class="form-control input-fixed-size input-sm">
				<button *ngIf="editing" type="button" (click)="addParameterInitialValue(p, '')" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-plus"></span>Add Value</button>
			</div>
			<div class ="col-md-4">
				<div class="row" *ngFor="let val of getParameterIntialValues(p)">
					<p *ngIf="!editing" class="form-control-static">{{val}}</p>
					<input *ngIf="editing" [ngModel]="val" (ngModelChange)="setParameterIntialValues(p, val, $event)" [ngModelOptions]="{standalone:true}"
						class="form-control input-fixed-size input-sm">
					<button *ngIf="editing" type="button" (click)="removeParameterInitialValue(p, val)" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span>Remove Value</button>
				</div>
			</div>
			<div class="col-md-1">
				<button *ngIf="editing" type="button" (click)="removeParameter(p)" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span>Remove Parameter</button>
			</div>
		</div>
		
		
		<hr>
		<hr-->


	<h4>Experiment parameters</h4>

		<div *ngIf="config.multiModel != null" class="row">
			<div class="col-md-3">
				<h5><label>Instance</label></h5>

				<ul class="list-group">
					<a *ngFor="let instance of config.multiModel.fmuInstances" (click)="selectParameterInstance(instance)" [class.active]="selectedParameterInstance === instance"
						class="list-group-item">{{instance.fmu.name}}.{{instance.name}}</a>
				</ul>
			</div>
			<div class="col-md-9">
				<div class="row">
					<div class="col-md-6">
						<h5><label>Parameters</label></h5>
					</div>
					<div *ngIf="selectedParameterInstance && editing" class="col-md-6">
						<div class="input-group">
							<select class="form-control input-sm" [(ngModel)]="newParameter" [ngModelOptions]="{standalone: true}">
								<option *ngFor="let parameter of getParameters(); let i=index" [ngValue]="parameter">{{parameter.name}}</option>
							</select>
							<span class="input-group-btn">
								<button type="button" (click)="addParameter()" class="btn btn-default btn-sm">
									<span class="glyphicon glyphicon-plus"></span> Add DSE parameter
							</button>
							</span>
						</div>
					</div>
				</div>

				<!-- NEEDS TO CHECK IN DSE CONFIG FIRST. IF THERE, THEN READ THAT, OTHERWISE LOOK IN MM -->
				<div *ngIf="selectedParameterInstance && dseParamExists(selectedParameterInstance)">
					IS A DSE
				</div>

				<!-- NEEDS TO CHECK IN DSE CONFIG FIRST. IF THERE, THEN READ THAT, OTHERWISE LOOK IN MM -->
				<div *ngIf="selectedParameterInstance && !dseParamExists(selectedParameterInstance)">
					<div *ngFor="let initialValue of getInitialValues(); let i=index" class="row">
						<div class="col-md-2">
							<p class="form-control-static">
								<span class="label label-info">{{getScalarTypeName(initialValue.scalarVariable.type)}}</span> {{initialValue.scalarVariable.name}}
								<span *ngIf="!initialValue.scalarVariable.isConfirmed" class="glyphicon glyphicon-info-sign pull-right" style="color: red"
									title="Variable is unconfirmed"></span>
							</p>
						</div>
						<div class="col-md-10">
							<p *ngIf="!editing" class="form-control-static">{{initialValue.value}}</p>
							<div *ngIf="editing" class="input-group">
								<input [value]="initialValue.value" (change)="setParameter(initialValue.scalarVariable, $event.target.value)" class="form-control input-sm">
								<!--span class="input-group-btn">
									<button type="button" (click)="removeParameter(selectedParameterInstance, initialValue.scalarVariable)" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span></button>
								</span-->
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>


		<hr>
		<hr>


		<h4>Parameter Constraints <button *ngIf="editing" type="button" (click)="addParameterConstraint()" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-plus"></span>Add Constraint</button></h4>

		<div class="row">
			<div class="col-md-4"><label>Constraint</label></div>
		</div>
		
		<div class="row" *ngFor="let p of config.paramConst">
			<div class ="col-md-4">
				<p *ngIf="!editing" class="form-control-static">{{getParameterConstraint(p)}}</p>
				<input *ngIf="editing" [ngModel]="getParameterConstraint(p)" (ngModelChange)="setParameterConstraint(p, $event)" [ngModelOptions]="{standalone:true}"
					class="form-control input-fixed-size">
			</div>
			<div class="col-md-1">
				<button *ngIf="editing" type="button" (click)="removeParameterConstraint(p)" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span>Remove Constraint</button>
			</div>
		</div>


		<hr>
		<hr>


		<h4>External Script Objectives <button *ngIf="editing" type="button" (click)="addExternalScript()" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-plus"></span></button> </h4>
		
		<div class="row">
			<div class="col-md-4"><label>Objective Name</label></div>
			<div class="col-md-4"><label>File Name</label></div>
			<div class="col-md-3"><label>Arguments</label></div>
		</div>

		<div class="row" *ngFor="let e of config.extScrObjectives">
			<div class = "col-md-4">
				<p *ngIf="!editing" class="form-control-static">{{getExternalScriptName(e)}}</p>
				<input *ngIf="editing" [ngModel]="getExternalScriptName(e)" (ngModelChange)="setExternalScriptName(e, $event)" [ngModelOptions]="{standalone:true}"
					class="form-control input-fixed-size input-sm">
				<button *ngIf="editing" type="button" (click)="removeExternalScript(e)" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span>Remove External Script</button>
			</div>
			<div class = "col-md-4">
				<p *ngIf="!editing" class="form-control-static">{{getExternalScriptFilename(e)}}</p>
				<input *ngIf="editing" [ngModel]="getExternalScriptFilename(e)" (ngModelChange)="setExternalScriptFileName(e, $event)" [ngModelOptions]="{standalone:true}"
					class="form-control input-fixed-size input-sm">
			</div>
			<div class = "col-md-3">
				<div class="row" *ngFor="let p of getExternalScriptParameters(e)">
					<div class = "col-md-1">
						<p *ngIf="!editing" class="form-control-static">{{p.id}}</p>
						<input *ngIf="editing" [ngModel]="p.id" (ngModelChange)="setExternalScriptParameterId(e, p, $event)" [ngModelOptions]="{standalone:true}"
							class="form-control input-fixed-size input-sm">
					</div>
					<div class = "col-md-2">
						<p *ngIf="!editing" class="form-control-static">{{p.value}}</p>
						<input *ngIf="editing" [ngModel]="p.value" (ngModelChange)="setExternalScriptParameterValue(e, p, $event)" [ngModelOptions]="{standalone:true}"
							class="form-control input-fixed-size input-sm">
						<button *ngIf="editing" type="button" (click)="removeExternalScriptParameter(e, p)" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span>Remove Argument</button>
					</div>
				</div>
			</div>

				<div class = "col-md-1">
					<button *ngIf="editing" type="button" (click)="addExternalScriptParameter(e, '')" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-plus"></span>Add Argument</button>
				</div>
		</div>


		<hr>
		<hr>

		<h4>Internal Function Objectives<button *ngIf="editing" type="button" (click)="addinternalFunction()" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-plus"></span></button> </h4>

		<hr>
		<hr>

		<h4>Objective Constraints <button *ngIf="editing" type="button" (click)="addObjectiveConstraint()" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-plus"></span>Add Constraint</button> </h4>

		<div class="row">
			<div class="col-md-4"><label>Constraint</label></div>
		</div>

		<div class="row" *ngFor="let o of config.objConst">
			<div class="col-md-4">
				<p *ngIf="!editing" class="form-control-static">{{getObjectiveConstraint(o)}}</p>
				<input *ngIf="editing" [ngModel]="getObjectiveConstraint(o)" (ngModelChange)="setObjectiveConstraint(o, $event)" [ngModelOptions]="{standalone:true}"
					class="form-control input-fixed-size input-sm">
			</div>
			<div class="col-md-1">
				<button *ngIf="editing" type="button" (click)="removeObjectiveConstraint(o)" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span>Remove Constraint</button>
			</div>
		</div>

		<hr>
		<hr>

		<h4>Ranking</h4>


		<div class="row">
				<div class="col-md-3"><label>Ranking Method</label></div>
				<div *ngIf="getRankingMethod() == 'Pareto'" class="col-md-6"><label>Dimensions</label></div>
		</div>
		
		<div class="row">
			<div class = "col-md-3">
				{{getRankingMethod()}}
				<button *ngIf="editing && getRankingMethod() == 'Pareto'" type="button" (click)="addParetoDimension('','')" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-plus"></span>Add Dimension</button>
			</div>
			<div class = "col-md-6">
			<div *ngIf="getRankingMethod() == 'Pareto'">
				<div class="row" *ngFor="let d of getRankingDimensions()">
					<div class = "col-md-3">
						<p *ngIf="!editing" class="form-control-static">{{getDimensionName(d)}}</p>
						<input *ngIf="editing" [ngModel]="getDimensionName(d)" (ngModelChange)="setDimensionName(d, $event)" [ngModelOptions]="{standalone:true}"
							class="form-control input-fixed-size input-sm">
					</div>
					<div class = "col-md-3">

						<p *ngIf="!editing" class="form-control-static">{{getDimensionDirection(d)}}</p>
						<input *ngIf="editing" [ngModel]="getDimensionDirection(d)" (ngModelChange)="setDimensionDirection(d, $event)" [ngModelOptions]="{standalone:true}"
							class="form-control input-fixed-size input-sm">			
						<button *ngIf="editing" type="button" (click)="removeParetoDimension(d)" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span>Remove Dimension</button>
					</div>
				</div>
			</div>
			</div>
		</div>

		<hr>
		
		<h4>Scenario<button *ngIf="editing" type="button" (click)="addScenario()" class="btn btn-default btn-xs"><span class="glyphicon glyphicon-plus"></span></button></h4>

		<div class="row" *ngFor="let s of config.scenarios">
			<div class="col-md-9">
				<p *ngIf="!editing" class="form-control-static">{{getScenario(s)}}</p>
				<input *ngIf="editing" [ngModel]="getScenario(s)" (ngModelChange)="setScenario(s, $event)" [ngModelOptions]="{standalone:true}"
					class="form-control input-fixed-size input-sm">
				<button *ngIf="editing" type="button" (click)="removeScenario(s)" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-remove"></span></button>
			</div>
		</div>
		
		<hr>



	<button *ngIf="!editing" class="btn btn-default" (click)="editing = true">
        <span class="glyphicon glyphicon-edit" aria-hidden="true"></span> Edit
    </button>
	<button *ngIf="editing" class="btn btn-default">
        <span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span> Save
    </button>
</form>